Jaml=function(){return{templates:{},register:function(a,b){this.templates[a]=b},render:function(a){var d=this.templates[a],e=new Jaml.Template(d);return e.render.apply(e,Array.prototype.slice.call(arguments,1))}}}(),Jaml.Node=function(a){this.tagName=a,this.attributes={},this.children=[]},Jaml.Node.prototype={setAttributes:function(a){for(var b in a){var c=b=="cls"?"class":b;this.attributes[c]=a[b]}return this},addChild:function(a){return this.children.push(a),this},render:function(a){a=a||0;var b=[],c=[],d=this instanceof Jaml.TextNode,e=this.multiLineTag();d||b.push(this.getPadding(a)),b.push("<"+this.tagName);for(var f in this.attributes)c.push(f+'="'+this.attributes[f]+'"');c.sort();for(var g=0;c.length>g;g++)b.push(" "+c[g]);return this.isSelfClosing()&&this.children.length==0?b.push("/>\n"):(b.push(">"),e&&b.push("\n"),this.renderChildren(b,this.children,a),e&&b.push(this.getPadding(a)),b.push("</",this.tagName,">\n")),b.join("")},renderChildren:function(a,b,c){for(var d=c+2,e=0;b.length>e;e++){var f=b[e];if(f instanceof Array){var g=f;this.renderChildren(a,g,c)}else a.push(f.render(d))}},multiLineTag:function(){var a=this.children.length,b=a>0;return a==1&&this.children[0]instanceof Jaml.TextNode&&(b=!1),b},getPadding:function(a){return Array(a+1).join(" ")},isSelfClosing:function(){for(var a=this.notSelfClosingTags.length-1;a>=0;a--)if(this.tagName==this.notSelfClosingTags[a])return!1;return!0},notSelfClosingTags:["textarea","script","em","strong","option","select"]},Jaml.TextNode=function(a){this.text=a},Jaml.TextNode.prototype={render:function(){return this.text}},Jaml.Template=function(a){this.tpl=a,this.nodes=[]},Jaml.Template.prototype={render:function(thisObj,data){with(data=data||(thisObj=thisObj||{}),(data.constructor+"").indexOf("Array")==-1&&(data=[data]),this)for(var i=0;data.length>i;i++)eval("("+(this.tpl+"")+").call(thisObj, data[i], i)");for(var roots=this.getRoots(),output="",i=0;roots.length>i;i++)output+=roots[i].render();return output},getRoots:function(){for(var a=[],b=0;this.nodes.length>b;b++){var c=this.nodes[b];c.parent==void 0&&a.push(c)}return a},tags:["html","head","body","script","meta","title","link","div","p","span","a","img","br","hr","em","strong","table","tr","th","td","thead","tbody","tfoot","ul","ol","li","dl","dt","dd","h1","h2","h3","h4","h5","h6","h7","form","fieldset","input","textarea","label","select","option"]},function(){for(var d,a=Jaml.Template.prototype.tags,b=function(a){return function(b){var c=new Jaml.Node(a),d=!(typeof b!="object"||b instanceof Jaml.Node||b instanceof Jaml.TextNode);d&&c.setAttributes(b);for(var e=d?1:0,f=e;arguments.length>f;f++){var g=arguments[f];(typeof g=="string"||g==void 0)&&(g=new Jaml.TextNode(g||"")),(g instanceof Jaml.Node||g instanceof Jaml.TextNode)&&(g.parent=c),c.addChild(g)}return this.nodes.push(c),c}},c=0;d=a[c];c++)Jaml.Template.prototype[d]=b(d)}()